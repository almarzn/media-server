- name: Create wireguard secret
  containers.podman.podman_secret:
    state: present
    name: '{{ wireguard.secret_name }}'
    data: '{{ private.proton_key }}'
  ignore_errors: true

- name: Install protonwire.container
  template:
    src: ../files/protonwire.container.j2
    dest: '{{ containers.unit.user }}/protonwire.container'
  register: protonwire_container

- name: Install testvpn.container
  template:
    src: ../files/testvpn.container.j2
    dest: '{{ containers.unit.user }}/testvpn.container'

- name: Create config
  become: true
  tags:
    - become
  file:
    path: '{{ qbittorrent_config }}'
    state: directory
    owner: '{{ ansible_user }}'
    group: '{{ ansible_group }}'

- name: Create log
  become: true
  tags:
    - become
  file:
    path: '{{ qbittorrent_log }}'
    state: directory
    owner: '{{ ansible_user }}'
    group: '{{ ansible_group }}'

- name: Create data
  become: true
  tags:
    - become
  file:
    path: '{{ qbittorrent_data }}'
    state: directory
    owner: '{{ ansible_user }}'
    group: '{{ ansible_group }}'

- name: Create cache
  become: true
  tags:
    - become
  file:
    path: '{{ qbittorrent_cache }}'
    state: directory
    owner: '{{ ansible_user }}'
    group: '{{ ansible_group }}'

- name: Create cache2
  become: true
  tags:
    - become
  tags:
    - become
  file:
    path: '{{ qbittorrent_cache2 }}'
    state: directory
    owner: '{{ ansible_user }}'
    group: '{{ ansible_group }}'

- name: Render qbittorrent.conf
  template:
    src: '../files/qBittorrent.conf.j2'
    dest: '{{ qbittorrent_config }}/qBittorrent.conf'

- name: Render watched_folders.json
  template:
    src: '../files/watched_folders.json.j2'
    dest: '{{ qbittorrent_config }}/watched_folders.json'

- name: Input Watched folder
  file:
    path: '{{ input_watched }}'
    state: directory

- name: Watched folder
  file:
    path: '{{ data_watched_basepath }}'
    state: directory

- name: Install qbittorrent.container
  template:
    src: ../files/qbittorrent.container.j2
    dest: '{{ containers.unit.user }}/qbittorrent.container'
  register: qbittorrent_container